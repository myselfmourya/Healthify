import{i as V,s as G,k as M,l as B,n as L,o as T,r as c,p as Q,q as Y,c as k,d as W,u as X,a as Z,j as e,e as ee,b as m,X as te,m as N,C as se,A as ae}from"./index-B0BMMOO8.js";import{M as oe,F as S}from"./MobileLayout-D2nqiddE.js";import{u as re}from"./useQuery-BrFl_B2D.js";import{C as ie}from"./ConfirmModal-Co7n_-f4.js";import{S as C}from"./shield-check-CqJhENm0.js";import{S as ne}from"./search-B1HaL0La.js";import{L as b}from"./lock-ynS1g4Q5.js";import{T as le}from"./trash-2-BQVqZfof.js";import"./circle-alert-CX-_l5l9.js";var de=class extends V{#t;#a=void 0;#e;#s;constructor(a,i){super(),this.#t=a,this.setOptions(i),this.bindMethods(),this.#o()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){const i=this.options;this.options=this.#t.defaultMutationOptions(a),G(this.options,i)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),i?.mutationKey&&this.options.mutationKey&&M(i.mutationKey)!==M(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(a){this.#o(),this.#r(a)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#o(),this.#r()}mutate(a,i){return this.#s=i,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(a)}#o(){const a=this.#e?.state??B();this.#a={...a,isPending:a.status==="pending",isSuccess:a.status==="success",isError:a.status==="error",isIdle:a.status==="idle",mutate:this.mutate,reset:this.reset}}#r(a){L.batch(()=>{if(this.#s&&this.hasListeners()){const i=this.#a.variables,s=this.#a.context,r={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(a?.type==="success"){try{this.#s.onSuccess?.(a.data,i,s,r)}catch(n){Promise.reject(n)}try{this.#s.onSettled?.(a.data,null,i,s,r)}catch(n){Promise.reject(n)}}else if(a?.type==="error"){try{this.#s.onError?.(a.error,i,s,r)}catch(n){Promise.reject(n)}try{this.#s.onSettled?.(void 0,a.error,i,s,r)}catch(n){Promise.reject(n)}}}this.listeners.forEach(i=>{i(this.#a)})})}};function ce(a,i){const s=T(),[r]=c.useState(()=>new de(s,a));c.useEffect(()=>{r.setOptions(a)},[r,a]);const n=c.useSyncExternalStore(c.useCallback(d=>r.subscribe(L.batchCalls(d)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),y=c.useCallback((d,u)=>{r.mutate(d,u).catch(Q)},[r]);if(n.error&&Y(r.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:y,mutateAsync:n.mutate}}const he=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],I=k("cloud-upload",he);const me=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],xe=k("download",me);const pe=[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1",key:"19aais"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5",key:"1w6v7t"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2",key:"pwaxnr"}]],R=k("folder-lock",pe);function ue(a,i="healthify_export.json"){const s="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a,null,2)),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",i),document.body.appendChild(r),r.click(),r.remove()}function ge(a,i){const s=window.open("","_blank");if(!s)return;const r=`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Clinical Summary - ${a?.name||"Patient"}</title>
            <style>
                body { font-family: system-ui, -apple-system, sans-serif; color: #1e293b; line-height: 1.6; padding: 40px; }
                h1 { color: #0f172a; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
                .section { margin-top: 30px; }
                .section-title { font-size: 18px; font-weight: bold; color: #334155; margin-bottom: 15px; background: #f8fafc; padding: 10px; border-radius: 6px; }
                table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                th, td { border: 1px solid #cbd5e1; padding: 12px; text-align: left; }
                th { background-color: #f1f5f9; font-weight: 600; }
                .footer { margin-top: 50px; font-size: 12px; color: #64748b; text-align: center; font-style: italic; }
            </style>
        </head>
        <body>
            <h1>Healthify Clinical Summary</h1>
            <p><strong>Patient Name:</strong> ${a?.name||"N/A"}</p>
            <p><strong>Age:</strong> ${a?.age||"N/A"}</p>
            <p><strong>Blood Group:</strong> ${a?.bloodGroup||"N/A"}</p>
            <p><strong>Known Conditions:</strong> ${(a?.diseases||[]).join(", ")||"None reported"}</p>
            <p><strong>Date Generated:</strong> ${new Date().toLocaleDateString()}</p>
            
            <div class="section">
                <div class="section-title">Health Records Inventory</div>
                ${i.length>0?`
                <table>
                    <thead>
                        <tr>
                            <th>Document Title</th>
                            <th>Category</th>
                            <th>Doctor</th>
                            <th>Uploaded Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${i.map(n=>`
                            <tr>
                                <td>${n.title}</td>
                                <td>${n.category}</td>
                                <td>${n.doctor||"Self"}</td>
                                <td>${new Date(n.uploadedAt).toLocaleDateString()}</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
                `:"<p>No health records on file.</p>"}
            </div>

            <div class="footer">
                Automatically generated by Healthify.<br/>
                This is a structured export meant for physician review or personal backup.
            </div>
            <script>
                // Auto-print when loaded
                window.onload = () => {
                    setTimeout(() => {
                        window.print();
                    }, 500);
                }
            <\/script>
        </body>
        </html>
    `;s.document.write(r),s.document.close()}const v=[{id:"Prescriptions",icon:S,color:"text-blue-500",bg:"bg-blue-50"},{id:"Lab Reports",icon:ee,color:"text-rose-500",bg:"bg-rose-50"},{id:"Vaccination",icon:C,color:"text-emerald-500",bg:"bg-emerald-50"}];function ke(){const{user:a}=W(),{addNotification:i}=X(),{t:s}=Z(),r=T(),[n,y]=c.useState(""),[d,u]=c.useState(null),[U,f]=c.useState(!1),[h,x]=c.useState({title:"",category:"Lab Reports",doctor:"",size:""}),[w,_]=c.useState(!1),[D,E]=c.useState(!1),[A,j]=c.useState(""),{data:g=[],isLoading:F}=re({queryKey:["records",a.userId],queryFn:async()=>{try{const t=await fetch("/api/records"),o=await t.json();if(!t.ok||o.error||o.success===!1)throw new Error(o.error||"Failed to fetch records");const l=Array.isArray(o.data)?o.data:Array.isArray(o)?o:[];return localStorage.setItem(`healthify_records_${a.userId}`,JSON.stringify(l)),l}catch(t){const o=localStorage.getItem(`healthify_records_${a.userId}`);if(o)try{const l=JSON.parse(o);if(Array.isArray(l))return l}catch{}throw t}},staleTime:1e3*60*60*24,initialData:()=>{const t=localStorage.getItem(`healthify_records_${a.userId}`);if(t)try{const o=JSON.parse(t);if(Array.isArray(o))return o}catch{}}}),P=ce({mutationFn:t=>fetch(`/api/records/${t}`,{method:"DELETE"}),onSuccess:()=>{r.invalidateQueries({queryKey:["records"]}),j("")}}),H=async t=>{const o=t.target.files?.[0];o&&x(l=>({...l,title:l.title||o.name.replace(/\.[^/.]+$/,""),size:`${(o.size/1024/1024).toFixed(1)} MB`}))},K=async()=>{if(!h.title)return;const t="temp_"+Date.now(),o={...h,id:t,userId:a.userId,uploadedAt:new Date().toISOString(),size:h.size||"0 MB"};r.setQueryData(["records",a.userId],l=>[o,...l||[]]),_(!0),E(!0),await new Promise(l=>setTimeout(l,1e3)),E(!1);try{const p=await(await fetch("/api/records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...h,userId:a.userId})})).json();r.setQueryData(["records",a.userId],J=>(J||[]).map($=>$.id===t?p:$)),i({type:"record",title:s("Encrypted & Uploaded"),message:`${h.title} ${s("added to Health Locker")}`}),f(!1),x({title:"",category:"Lab Reports",doctor:"",size:""})}catch{r.invalidateQueries({queryKey:["records",a.userId]}),i({type:"alert",title:s("Upload Failed"),message:s("Please check your connection and try again.")})}_(!1)},z=async t=>{navigator.share?await navigator.share({title:t.title,text:`Health Record: ${t.title} (${t.category})`}):(await navigator.clipboard.writeText(`Health Record: ${t.title}`),i({type:"info",title:s("Copied"),message:s("Record info copied to clipboard")}))},O=g.filter(t=>{const o=!n||t.title.toLowerCase().includes(n.toLowerCase())||t.category.toLowerCase().includes(n.toLowerCase()),l=!d||t.category===d;return o&&l}),q=t=>g.filter(o=>o.category===t).length;return e.jsxs(oe,{children:[e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsxs("div",{className:"mb-6 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-500 mb-1.5",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("h2",{className:"text-[10px] font-bold uppercase tracking-widest text-indigo-500",children:s("Health Locker")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ue({profile:a,records:g},`healthify_${a.name.replace(/\s+/g,"_")}_export.json`),className:"flex items-center gap-1.5 px-2.5 py-1 bg-white border border-gray-200 shadow-sm rounded-full text-[10px] font-bold text-gray-700 hover:bg-gray-50 transition-colors",title:"Export Raw Data (JSON)",children:[e.jsx(xe,{className:"w-3 h-3 text-indigo-500"})," Export"]}),e.jsxs("button",{onClick:()=>ge(a,g),className:"flex items-center gap-1.5 px-2.5 py-1 bg-indigo-600 shadow-sm shadow-indigo-200 rounded-full text-[10px] font-bold text-white hover:bg-indigo-700 transition-colors",title:"Clinical Summary (PDF)",children:[e.jsx(S,{className:"w-3 h-3 text-indigo-200"})," Summary"]})]})]}),e.jsxs("h1",{className:"text-[26px] font-bold text-gray-900 leading-[1.15]",children:[s("Your Health Vault"),e.jsx("br",{}),e.jsxs("span",{className:"text-emerald-500 text-lg flex items-center gap-1.5 mt-1 border border-emerald-100 bg-emerald-50 px-2.5 py-1 rounded-full w-fit shadow-sm",children:[e.jsx(C,{className:"w-4 h-4"})," ",s("End-to-End Encrypted")]})]})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(ne,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{className:"w-full pl-11 pr-4 py-4 rounded-2xl bg-white border border-gray-100 text-sm focus:outline-none shadow-[0_4px_20px_rgb(0,0,0,0.04)]",placeholder:s("Search documents..."),value:n,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-8",children:[v.map(({id:t,icon:o,color:l,bg:p})=>e.jsxs("button",{onClick:()=>u(d===t?null:t),className:m("rounded-[1.5rem] p-5 text-left transition-all border border-gray-100/50 flex flex-col items-start min-h-[140px]",d===t?"bg-indigo-600 shadow-md shadow-indigo-200":"bg-white shadow-[0_2px_15px_rgb(0,0,0,0.03)] hover:shadow-md"),children:[e.jsx("div",{className:m("w-10 h-10 rounded-xl flex items-center justify-center mb-auto",d===t?"bg-white/20":p),children:e.jsx(o,{className:m("w-5 h-5",d===t?"text-white":l)})}),e.jsxs("div",{children:[e.jsx("p",{className:m("font-bold text-[13px] leading-tight mb-0.5",d===t?"text-white":"text-gray-900"),children:s(t)}),e.jsxs("p",{className:m("text-[10px] font-medium",d===t?"text-indigo-200":"text-gray-400"),children:[q(t)," ",s("Files")]})]})]},t)),e.jsxs("button",{onClick:()=>f(!0),className:"bg-indigo-50 rounded-[1.5rem] p-5 flex flex-col items-center justify-center text-center transition-colors group min-h-[140px]",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-500 text-white flex items-center justify-center mb-3 shadow-[0_0_15px_rgba(99,102,241,0.4)] group-hover:scale-110 transition-transform",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("p",{className:"font-bold text-indigo-700 text-[13px]",children:s("Upload New")})]})]}),e.jsxs("div",{className:"flex justify-between items-end mb-4 px-1",children:[e.jsx("h3",{className:"font-bold text-[15px] text-gray-900 leading-none",children:s(d||"Recent Documents")}),d?e.jsxs("button",{onClick:()=>u(null),className:"text-[11px] text-indigo-600 font-bold flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"})," ",s("Clear filter")]}):e.jsx("button",{className:"text-[11px] text-indigo-500 font-bold",children:s("View all")})]}),F?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"glass rounded-2xl p-4 flex gap-3 animate-pulse",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-200 shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]},t))}):O.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-400 bg-white rounded-3xl border border-dashed border-gray-200 p-8 shadow-sm",children:[e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-4",children:[e.jsx(R,{className:"w-full h-full opacity-30 text-indigo-600"}),e.jsx(b,{className:"w-6 h-6 absolute -bottom-1 -right-1 text-emerald-500 opacity-80 bg-white rounded-full p-0.5 border border-emerald-100"})]}),e.jsx("p",{className:"font-bold text-gray-700 mb-1",children:s("Vault Empty")}),e.jsx("p",{className:"text-xs",children:s("Upload your first health record for secure, encrypted storage.")})]}):e.jsx("div",{className:"space-y-3 pb-8",children:O.map((t,o)=>{const l=v.find(p=>p.id===t.category);return e.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.05},className:"bg-white rounded-2xl p-4 flex items-center gap-4 border border-gray-100 shadow-[0_4px_20px_rgb(0,0,0,0.03)]",children:[e.jsx("div",{className:m("w-10 h-10 rounded-xl flex items-center justify-center shrink-0",l?.bg||"bg-indigo-50"),children:e.jsx(S,{className:m("w-4 h-4",l?.color||"text-indigo-500")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-[13px] font-bold text-gray-900 truncate mb-0.5 flex items-center gap-1.5",children:[e.jsx(b,{className:"w-3 h-3 text-emerald-500 drop-shadow-sm shrink-0"}),t.title]}),e.jsxs("p",{className:"text-[10px] text-gray-500 font-medium",children:[new Date(t.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})," â€¢ ",t.doctor||s("No Doctor")]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-900 mr-1",children:t.size}),e.jsx("button",{onClick:()=>z(t),className:"text-gray-400 hover:text-indigo-600 transition-colors",children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(t.id),className:"text-gray-300 hover:text-red-500 transition-colors hidden group-hover:block ml-1",children:e.jsx(le,{className:"w-4 h-4"})})]})]},t.id)})})]}),e.jsx(ae,{children:U&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[60] backdrop-blur-sm",onClick:()=>f(!1)}),e.jsxs(N.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25},className:"fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white rounded-t-[32px] z-[70] p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg leading-tight",children:s("Secure Vault")}),e.jsx("p",{className:"text-xs font-medium text-emerald-600",children:"AES-256 Military Grade Encryption"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-1.5 block",children:s("Document Name")}),e.jsx("input",{className:"w-full px-4 py-3 border border-gray-200 rounded-2xl text-sm focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all font-medium text-gray-900 bg-gray-50",placeholder:s("e.g. Blood Test Report"),value:h.title,onChange:t=>x(o=>({...o,title:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-1.5 block",children:s("Category")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.map(({id:t})=>e.jsxs("button",{onClick:()=>x(o=>({...o,category:t})),className:m("py-2.5 px-3 rounded-xl text-xs font-bold transition-all border text-left flex items-center justify-between",h.category===t?"bg-indigo-600 text-white border-indigo-600 shadow-md shadow-indigo-200":"bg-white text-gray-600 border-gray-200 hover:border-indigo-200"),children:[t,h.category===t&&e.jsx(C,{className:"w-4 h-4 opacity-70"})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-1.5 block",children:s("Doctor Name")}),e.jsx("input",{className:"w-full px-4 py-3 border border-gray-200 rounded-2xl text-sm focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all font-medium text-gray-900 bg-gray-50",placeholder:s("Dr. Name (optional)"),value:h.doctor,onChange:t=>x(o=>({...o,doctor:t.target.value}))})]}),e.jsxs("label",{className:"flex items-center gap-3 border-2 border-dashed border-indigo-200 bg-white rounded-2xl p-4 cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-colors group mt-2",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center group-hover:bg-indigo-100 transition-colors",children:e.jsx(I,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[13px] font-bold text-gray-800 block mb-0.5",children:s("Select File")}),e.jsx("span",{className:"text-[11px] font-medium text-gray-500",children:"PDF, JPG, PNG up to 10MB"})]}),e.jsx("input",{type:"file",accept:".pdf,image/*",className:"hidden",onChange:H})]})]}),e.jsx("button",{onClick:K,disabled:!h.title||w,className:m("w-full mt-6 py-4 rounded-[20px] font-bold uppercase tracking-wider text-[11px] transition-all flex items-center justify-center",h.title&&!w?"bg-indigo-600 text-white hover:bg-indigo-700 shadow-[0_4px_15px_rgba(79,70,229,0.3)]":"bg-gray-100 text-gray-400 cursor-not-allowed",D&&"bg-emerald-600 shadow-[0_4px_15px_rgba(5,150,105,0.3)] text-white"),children:D?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 animate-pulse"})," ",s("Encrypting & Securing Data...")]}):s(w?"Saving...":"Save to Encrypted Vault")})]})]})}),e.jsx(ie,{isOpen:!!A,title:s("Delete Record?"),description:s("This action will permanently remove this health document and cannot be undone."),confirmText:s("Delete"),cancelText:s("Keep"),danger:!0,onConfirm:()=>P.mutate(A),onCancel:()=>j("")})]})}export{ke as default};
