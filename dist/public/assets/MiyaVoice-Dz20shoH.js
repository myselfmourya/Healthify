import{f as R,a as C,d as _,r as d,j as e,L as O,U as V,A as P,m as b,b as S,_ as I}from"./index-B0BMMOO8.js";import{A as U}from"./arrow-left-CH1M9uQR.js";import{M as $}from"./mic-BayHx9nl.js";function H(){const{languageCode:u}=R(),{t:r}=C(),{user:g}=_(),[w,y]=d.useState(!1),[p,x]=d.useState(!1),[N,M]=d.useState(""),[j,h]=d.useState(""),f=d.useRef(null),o=window.speechSynthesis,T=["What are the risks of high cholesterol?","Is there a connection between sleep and heart health?","Tell me about Type 2 Diabetes prevention."],v=d.useCallback(()=>{f.current&&(f.current.stop(),f.current=null),o&&o.cancel(),y(!1),x(!1)},[o]);d.useEffect(()=>()=>v(),[v]);const m=s=>{if(!o)return;o.cancel();const n=new SpeechSynthesisUtterance(s),i=o.getVoices();let a=null;const l=u.toLowerCase();l.startsWith("en")?(a=i.find(t=>(t.lang.includes("en-IN")||t.lang.includes("en_IN"))&&(t.name.toLowerCase().includes("female")||["Aditi","Heera","Zira","Priya"].some(c=>t.name.includes(c)))),a||(a=i.find(t=>t.lang.startsWith("en")&&t.name.toLowerCase().includes("female")))):l.startsWith("hi")&&(a=i.find(t=>t.lang.includes("hi-IN")&&(t.name.toLowerCase().includes("female")||["Kalpana","Lekha","Sangeeta"].some(c=>t.name.includes(c)))),a||(a=i.find(t=>t.name.toLowerCase().includes("female")))),a||(a=i.find(t=>t.name.toLowerCase().includes("female"))),a||(a=i.find(t=>t.lang.toLowerCase().startsWith(l.split("-")[0]))),a&&(n.voice=a),n.lang=u,n.rate=1,n.pitch=1.1,n.onstart=()=>x(!0),n.onend=()=>{x(!0),setTimeout(()=>{x(!1),k()},100)},n.onerror=()=>{x(!1),k()},o.speak(n)},L=async s=>{y(!1),M(s),h(r("Thinking..."));const i={en:"English","en-IN":"Indian English",hi:"Hindi","hi-IN":"Hindi"}[u]||"English";if(!navigator.onLine){const{findOfflineMedicalMatch:a}=await I(async()=>{const{findOfflineMedicalMatch:t}=await import("./offlineMedicalDictionary-0wAjtrVo.js");return{findOfflineMedicalMatch:t}},[]),l=a(s);if(l){const t=`[Offline Mode] ${l.condition}: ${l.precautions.join(", ")}. Medicines: ${l.medicines.map(c=>c.name).join(", ")||"None"}. ${l.whenToSeeDoctor}`;h(t),m(t);return}else{const t=r("I'm currently offline and couldn't find information about that. Please check your connection for a full consultation.");h(t),m(t);return}}try{const a=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`CRITICAL: Respond ONLY in ${i}. 
                             User Profile: Mourya.
                             Tone: Warm, Indian Female Health Assistant.
                             Task: Respond correctly and medically responsibly to "${s}".
                             Formatting: Use clear, simple bullet points. Keep it punchy and professional.`,history:[],userName:g.name||"Mourya"})});if(!a.ok)throw new Error("API Failed");const l=await a.json();if(h(l.reply),o.getVoices().length===0){const t=()=>{m(l.reply),window.speechSynthesis.removeEventListener("voiceschanged",t)};window.speechSynthesis.addEventListener("voiceschanged",t)}else m(l.reply)}catch{const{findOfflineMedicalMatch:l}=await I(async()=>{const{findOfflineMedicalMatch:c}=await import("./offlineMedicalDictionary-0wAjtrVo.js");return{findOfflineMedicalMatch:c}},[]),t=l(s);if(t){const c=`${t.condition}: ${t.precautions.join(", ")}. ${t.whenToSeeDoctor}`;h(c),m(c)}else h(r("Sorry, I had trouble connecting.")),m(r("Sorry, I had trouble connecting."))}},k=()=>{p&&o.cancel();const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s)return;f.current&&f.current.stop();const n=new s;n.lang=u==="en"?"en-IN":u,n.interimResults=!1,n.onstart=()=>y(!0),n.onresult=i=>{const a=i.results[0][0].transcript;L(a)},n.onerror=i=>{i.error==="no-speech"&&n.stop()},n.onend=()=>y(!1),n.start(),f.current=n},E=()=>{w||p?v():k()};d.useEffect(()=>{if(o){o.getVoices();const s=()=>o.getVoices();return window.speechSynthesis.addEventListener("voiceschanged",s),()=>window.speechSynthesis.removeEventListener("voiceschanged",s)}},[o]);const A=()=>{const s=new Date().getHours();return s>=0&&s<5?r("Good Night"):s<12?r("Good Morning"):s<17?r("Good Afternoon"):r("Good Evening")};return e.jsxs("div",{className:"h-screen w-screen bg-slate-50 flex flex-col p-8 relative overflow-hidden font-sans",children:[e.jsxs("div",{className:"z-20 flex justify-between items-center mb-12",children:[e.jsx(O,{href:"/",children:e.jsx("a",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-slate-600 transition-all shadow-sm",children:e.jsx(U,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none mb-1",children:[A(),","]}),e.jsx("h1",{className:"text-lg font-black text-slate-800 tracking-tight leading-none",children:g.name||"User"})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm flex items-center justify-center overflow-hidden",children:g.avatar?e.jsx("img",{src:g.avatar,alt:"User",className:"w-full h-full object-cover"}):e.jsx(V,{className:"w-5 h-5 text-slate-300"})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center max-w-xl mx-auto w-full z-20",children:e.jsxs(P,{mode:"wait",children:[!j&&!N&&e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-center space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-4xl font-black text-slate-900 tracking-tight",children:r("How can I help?")}),e.jsx("p",{className:"text-slate-400 text-sm font-medium",children:r("Tap the mic to start your health consultation")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:T.map((s,n)=>e.jsx("button",{onClick:()=>L(s),className:"px-6 py-4 bg-white/50 border border-slate-100 rounded-2xl text-slate-600 text-sm font-bold hover:bg-white hover:border-slate-200 hover:shadow-md transition-all text-center",children:r(s)},n))})]},"initial-state"),N&&!j&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center",children:e.jsxs("p",{className:"text-2xl font-bold text-slate-400 italic leading-relaxed",children:['"',N,'"']})},"listening"),j&&e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-center mb-4",children:[e.jsx("div",{className:"w-8 h-[1px] bg-slate-200"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-500",children:r("MIYA")}),e.jsx("div",{className:"w-8 h-[1px] bg-slate-200"})]}),e.jsx("div",{className:"space-y-6 text-center",children:j.split(`
`).map((s,n)=>{const i=s.trim();return i?i.startsWith("*")||i.startsWith("-")||/^\d+\./.test(i)?e.jsxs("div",{className:"flex gap-3 items-start justify-center text-left max-w-md mx-auto",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2.5 shrink-0"}),e.jsx("p",{className:"text-lg font-bold text-slate-700",children:i.replace(/^[-*]|\d+\.\s+/,"").replace(/\*\*/g,"")})]},n):e.jsx("p",{className:"text-xl font-black text-slate-800 leading-tight",children:i.replace(/\*\*/g,"")},n):e.jsx("div",{className:"h-2"},n)})})]},"response")]})}),e.jsxs("div",{className:"z-20 py-12 flex flex-col items-center",children:[e.jsx("button",{onClick:E,className:S("relative w-20 h-20 rounded-full flex items-center justify-center transition-all duration-500",p||w?"bg-slate-900 shadow-2xl scale-110":"bg-white border border-slate-200 shadow-lg hover:shadow-xl active:scale-95"),children:p?e.jsx("div",{className:"flex gap-1.5 h-6 items-center",children:[1,2,3].map(s=>e.jsx(b.div,{animate:{height:[8,24,8,16,8]},transition:{duration:.6,repeat:1/0,delay:s*.1},className:"w-1 bg-white rounded-full"},s))}):e.jsx($,{className:S("w-8 h-8 transition-colors",w?"text-white animate-pulse":"text-slate-800")})}),e.jsx("p",{className:"mt-4 text-[10px] font-black uppercase tracking-[0.2em] text-slate-400",children:r(w?"listening...":p?"speaking...":"Tap to talk")})]})]})}export{H as default};
