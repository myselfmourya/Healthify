import{T,V as z}from"./index-B0BMMOO8.js";var k,N;function Y(){if(N)return k;N=1;var v="Expected a function",r=NaN,o="[object Symbol]",i=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,d=/^0o[0-7]+$/i,R=parseInt,C=typeof T=="object"&&T&&T.Object===Object&&T,F=typeof self=="object"&&self&&self.Object===Object&&self,P=C||F||Function("return this")(),M=Object.prototype,D=M.toString,Q=Math.max,G=Math.min,I=function(){return P.Date.now()};function J(e,n,c){var l,g,j,m,s,h,b=0,W=!1,p=!1,S=!0;if(typeof e!="function")throw new TypeError(v);n=A(n)||0,O(c)&&(W=!!c.leading,p="maxWait"in c,j=p?Q(A(c.maxWait)||0,n):j,S="trailing"in c?!!c.trailing:S);function E(t){var f=l,x=g;return l=g=void 0,b=t,m=e.apply(x,f),m}function K(t){return b=t,s=setTimeout(w,n),W?E(t):m}function U(t){var f=t-h,x=t-b,L=n-f;return p?G(L,j-x):L}function $(t){var f=t-h,x=t-b;return h===void 0||f>=n||f<0||p&&x>=j}function w(){var t=I();if($(t))return B(t);s=setTimeout(w,U(t))}function B(t){return s=void 0,S&&l?E(t):(l=g=void 0,m)}function V(){s!==void 0&&clearTimeout(s),b=0,l=h=g=s=void 0}function X(){return s===void 0?m:B(I())}function q(){var t=I(),f=$(t);if(l=arguments,g=this,h=t,f){if(s===void 0)return K(h);if(p)return s=setTimeout(w,n),E(h)}return s===void 0&&(s=setTimeout(w,n)),m}return q.cancel=V,q.flush=X,q}function O(e){var n=typeof e;return!!e&&(n=="object"||n=="function")}function _(e){return!!e&&typeof e=="object"}function H(e){return typeof e=="symbol"||_(e)&&D.call(e)==o}function A(e){if(typeof e=="number")return e;if(H(e))return r;if(O(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=O(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=e.replace(i,"");var c=a.test(e);return c||d.test(e)?R(e.slice(2),c?2:8):u.test(e)?r:+e}return k=J,k}var Z=Y();const ee=z(Z);class y{constructor(){this.requestQueue=new Set}static getInstance(){return y.instance||(y.instance=new y),y.instance}async executeWithBackoff(r,o,i=3,u=1e3){try{const a=await fetch(r,o);if(a.status===429&&i>0)return console.warn(`[AIClient] 429 Too Many Requests. Retrying in ${u}ms...`),await new Promise(d=>setTimeout(d,u)),this.executeWithBackoff(r,o,i-1,u*2);if(!a.ok){const d=await a.text();throw new Error(`API Error ${a.status}: ${d}`)}return a}catch(a){if(i>0)return console.warn(`[AIClient] Network error. Retrying in ${u}ms...`),await new Promise(d=>setTimeout(d,u)),this.executeWithBackoff(r,o,i-1,u*2);throw a}}async fetchAI(r){const o=JSON.stringify(r);if(this.requestQueue.has(o))throw new Error("Duplicate request ignored");this.requestQueue.add(o);try{return await(await this.executeWithBackoff(r.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.payload)})).json()}finally{this.requestQueue.delete(o)}}}const te=y.getInstance(),re=ee(async(v,r,o)=>{try{const i=await te.fetchAI(v);r(i)}catch(i){i.message!=="Duplicate request ignored"&&o(i.message||"Failed to fetch AI response")}},800);export{re as d};
